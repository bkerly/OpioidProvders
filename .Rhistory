rm(ls())
rm(ls(all.names = TRUE))
# Load the relevant libraries - do this every time
library(lubridate)
library(ggplot2)
library(dplyr)
library(data.table)
library(ggrepel)
library(tidyverse)
deaths <- read_csv("Desktop/Brian Stuff/SalishRG/Opioid Provider Mapping/OpioidProvders/data/co_opioid_death_1418.csv")
deaths <- read_csv("/Users/brianerly/BEEFERS/OpioidProvders/Data/co_opioid_death_1418.csv")
library(ggmap)
DATAproviders <- read_csv("Data/ColoradoDATAGeoTagged.csv")
DATAproviders <- read_csv("Data/ColoradoDATAProvidersGeoTagged.csv")
OTPs <- read_csv("Data/ColoradoOTPGeoTagged.csv")
m <- get_map(getbb("Colorado"),maptype = "toner-background")
library(ggmap)
m <- get_map(getbb("Colorado"),maptype = "toner-background")
library(osmdata)
m <- get_map(getbb("Colorado"),maptype = "toner-background")
?getbb
??getbb
library(sf)
m <- get_map(getbb("Colorado"),maptype = "toner-background")
?getbb()
library(osmdata)
install.packages("osmdata")
install.packages("sf")
library(osmdata)
m <- get_map(getbb("Colorado"),maptype = "toner-background")
m
ggmap(m)
ggmap(m) +
geom_point(aes(data=OTPs, x = lon, y= lat))
ggmap(m) +
geom_point(data=OTPs aes(x = lon, y= lat))
ggmap(m) +
geom_point(data=OTPs, aes(x = lon, y= lat))
ggmap(m) +
geom_point(data=OTPs, aes(x = lon, y= lat, color= col1)) +
geom_point(data=DATAproviders, aes(x=lon, y=lat, color = col2))
ol1 = "#011f4b"
col2 = "#6497b1"
col3 = "#b3cde0"
col4 = "#CC0000"
ggmap::register_google(key = "AIzaSyD5w9yNOufvfRxcdGX0TlTZV6nIU63vTEk")
m <- get_map(getbb("Colorado"),maptype = "toner-background")
ggmap(m) +
geom_point(data=OTPs, aes(x = lon, y= lat, color= col1)) +
geom_point(data=DATAproviders, aes(x=lon, y=lat, color = col2))
ggmap(m) +
geom_point(data=OTPs, aes(x = lon, y= lat, color= "col1")) +
geom_point(data=DATAproviders, aes(x=lon, y=lat, color = "col2"))
ggmap(m) +
geom_point(data=DATAproviders, aes(x=lon, y=lat, color = "col2"))+
geom_point(data=OTPs, aes(x = lon, y= lat, color= "col1"))
DATA_Provider_Locations = "#011f4b"
OTP_Locations = "#6497b1"
col3 = "#b3cde0"
col4 = "#CC0000"
ggmap::register_google(key = "AIzaSyD5w9yNOufvfRxcdGX0TlTZV6nIU63vTEk")
m <- get_map(getbb("Colorado"),maptype = "toner-background")
ggmap(m) +
geom_point(data=DATAproviders, aes(x=lon, y=lat, color = "DATA_Provider_Locations"))+
geom_point(data=OTPs, aes(x = lon, y= lat, color= "OTP_Locations"))
m <- get_map(getbb("Colorado"),source="stamen",maptype = "toner-background")
ggmap(m) +
geom_point(data=DATAproviders, aes(x=lon, y=lat, color = "DATA_Provider_Locations"))+
geom_point(data=OTPs, aes(x = lon, y= lat, color= "OTP_Locations"))
library(ggmap)
library(osmdata)
library(sf)
library(spData)
library(lwgeom)
library(tidycensus)
#Get centroid of all the census tracts
census_api_key("efb75012a4507416a09b0fbd0c90b9b2b4582632")
co17 <- get_acs(geography = "tract",
variables = c(totpop="B03002_001"),
state = "CO", year=2017, geometry = TRUE)
#Get centroid of each census tract
co18<-(co17[,6])
co18$centroids <- st_transform(co18, 29101) %>%
st_centroid() %>% st_transform(., '+proj=longlat +ellps=GRS80 +no_defs') %>%
st_geometry()
View(co18)
head(bind_rows(co17,co18))
head(bind_rows(co17,co18$centroids))
head(bind_rows(co17$GEOID,co18$centroids))
?bind_rows
head(bind_rows(co17$GEOID,co18$centroids,id=NULL))
co17 <- get_acs(geography = "tract",
variables = c(totpop="B03002_001"),
state = "CO", year=2017, geometry = TRUE)
#Get centroid of each census tract
co18<-(co17[,6])
co18$centroids <- st_transform(co18, 29101) %>%
st_centroid() %>% st_transform(., '+proj=longlat +ellps=GRS80 +no_defs') %>%
st_geometry()
head(bind_rows(co17$GEOID,co18$centroids,id=NULL))
bind_rows(co17$GEOID,co18$centroids,id=NULL))
bind_rows(co17$GEOID,co18$centroids,id=NULL)
head(co18$centroids)
head(stat_sf_coordinates(co18$centroids))
class(col18$centroids)
class(co18$centroids)
?sf_transform
??sf_transform
View(co18)
do.call(rbind, st_geometry(co18$centroids)) %>%
as_tibble() %>% setNames(c("lon","lat"))
do.call(rbind, st_geometry(seal_sf))
do.call(rbind, st_geometry(co18$centroids))
head(st_geometry(co18$centroids))
CTCoords <- bind_rows(co17$GEOID,co18$centroids,id=NULL) %>%
`rownames<-`(c("lat","long"))
CTCoords <- do.call(rbind, st_geometry(co18$centroids)) %>%
`rownames<-`(c("lat","long"))
CTCoords <- do.call(rbind, st_geometry(co18$centroids))
View(CTCoords)
CTCoords <- do.call(rbind, st_geometry(co18$centroids)) %>%
as.data.frame() %>%
`rownames<-`(c("lat","long"))
CTCoords <- do.call(rbind, st_geometry(co18$centroids)) %>%
as.data.frame()
CTCoords <- do.call(rbind, st_geometry(co18$centroids)) %>%
as.data.frame() %>%
`colnames<-`(c("lat","long"))
CTCoords <- do.call(rbind, st_geometry(co18$centroids)) %>%
as.data.frame() %>%
`colnames<-`(c("lat","long"))
CTCoords <- bind_rows(co17$GEOID,CTCoords,id=NULL)
CTCoords <- left_join(co17$GEOID,CTCoords,id=NULL)
CTCoords <- bind_cols(co17,CTCoords,id=NULL)
CTCoords <- do.call(rbind, st_geometry(co18$centroids)) %>%
as.data.frame() %>%
`colnames<-`(c("lat","lon"))
CTCoords <- bind_cols(co17,CTCoords,id=NULL) %>%
select("GEOID","lat","lon")
deaths <- read_csv("/Users/brianerly/BEEFERS/OpioidProvders/Data/co_opioid_death_1418.csv")
deaths$d <- ifelse(deaths$d == ".",1,deaths$d)
deaths$d <- as.numeric(deaths$d)
deaths <- left_join(deaths,CTCoords,by=c("tractid"="GEOID"))
deaths <- left_join(deaths,CTCoords,by=c("tractid"="GEOID")) %>%
as.data.frame() %>%
select("tractid","d","lat","lon")
deaths <- left_join(deaths,CTCoords,by=c("tractid"="GEOID")) %>%
as.data.frame()
CTCoords <- bind_cols(co17,CTCoords,id=NULL) %>%
select("GEOID","lat","lon")
deaths <- read_csv("/Users/brianerly/BEEFERS/OpioidProvders/Data/co_opioid_death_1418.csv")
deaths$d <- ifelse(deaths$d == ".",1,deaths$d)
deaths$d <- as.numeric(deaths$d)
deaths <- left_join(deaths,CTCoords,by=c("tractid"="GEOID")) %>%
as.data.frame() %>%
select("tractid","d","lat","lon")
ggmap(m) +
stat_density2d(data=deaths, aes(x=lon,y=lat,fill=..level.., alpha =..level..),geom="polygon")
?stat_density2d
ggmap(m) +
stat_density2d(data=deaths, aes(x=lon,y=lat,fill=..level.., alpha =..level..),geom="polygon")+
scale_fill_gradientn(colours=rev(brewer.pal(7, "Spectral")))
library(RColorBrewer)
ggmap(m) +
stat_density2d(data=deaths, aes(x=lon,y=lat,fill=..level.., alpha =..level..),geom="polygon")+
scale_fill_gradientn(colours=rev(brewer.pal(7, "Spectral")))
Death_Locations = "#b3cde0"
ggmap(m) +
geom_point(data=deaths, aes(x=lon, y=lat, color = "Death_Locations"))+
geom_point(data=DATAproviders, aes(x=lon, y=lat, color = "DATA_Provider_Locations"))+
geom_point(data=OTPs, aes(x = lon, y= lat, color= "OTP_Locations"))
ggmap(m) +
geom_point(data=deaths, aes(x=lon, y=lat, color = "Death_Locations"))
CTCoords <- bind_cols(co17,CTCoords,id=NULL) %>%
select("GEOID","lon","lat")
deaths <- read_csv("/Users/brianerly/BEEFERS/OpioidProvders/Data/co_opioid_death_1418.csv")
deaths$d <- ifelse(deaths$d == ".",1,deaths$d)
deaths$d <- as.numeric(deaths$d)
deaths <- left_join(deaths,CTCoords,by=c("tractid"="GEOID")) %>%
as.data.frame() %>%
select("tractid","d","lat","lon")
DATAproviders <- read_csv("Data/ColoradoDATAProvidersGeoTagged.csv")
OTPs <- read_csv("Data/ColoradoOTPGeoTagged.csv")
DATA_Provider_Locations = "#011f4b"
OTP_Locations = "#6497b1"
Death_Locations = "#b3cde0"
col4 = "#CC0000"
ggmap::register_google(key = "AIzaSyD5w9yNOufvfRxcdGX0TlTZV6nIU63vTEk")
m <- get_map(getbb("Colorado"),source="stamen",maptype = "toner-background")
ggmap(m) +
geom_point(data=deaths, aes(x=lon, y=lat, color = "Death_Locations"))
CTCoords <- bind_cols(co17,CTCoords,id=NULL) %>%
select("GEOID","lat","lon")
deaths <- read_csv("/Users/brianerly/BEEFERS/OpioidProvders/Data/co_opioid_death_1418.csv")
deaths$d <- ifelse(deaths$d == ".",1,deaths$d)
deaths$d <- as.numeric(deaths$d)
deaths <- left_join(deaths,CTCoords,by=c("tractid"="GEOID")) %>%
as.data.frame() %>%
select("tractid","d","lat","lon")
DATAproviders <- read_csv("Data/ColoradoDATAProvidersGeoTagged.csv")
OTPs <- read_csv("Data/ColoradoOTPGeoTagged.csv")
DATA_Provider_Locations = "#011f4b"
OTP_Locations = "#6497b1"
Death_Locations = "#b3cde0"
col4 = "#CC0000"
ggmap::register_google(key = "AIzaSyD5w9yNOufvfRxcdGX0TlTZV6nIU63vTEk")
m <- get_map(getbb("Colorado"),source="stamen",maptype = "toner-background")
ggmap(m) +
geom_point(data=deaths, aes(x=lon, y=lat, color = "Death_Locations"))
CTCoords <- do.call(rbind, st_geometry(co18$centroids)) %>%
as.data.frame() %>%
`colnames<-`(c("lon","lat"))
CTCoords <- bind_cols(co17,CTCoords,id=NULL) %>%
select("GEOID","lat","lon")
deaths <- read_csv("/Users/brianerly/BEEFERS/OpioidProvders/Data/co_opioid_death_1418.csv")
deaths$d <- ifelse(deaths$d == ".",1,deaths$d)
deaths$d <- as.numeric(deaths$d)
deaths <- left_join(deaths,CTCoords,by=c("tractid"="GEOID")) %>%
as.data.frame() %>%
select("tractid","d","lat","lon")
DATAproviders <- read_csv("Data/ColoradoDATAProvidersGeoTagged.csv")
OTPs <- read_csv("Data/ColoradoOTPGeoTagged.csv")
DATA_Provider_Locations = "#011f4b"
OTP_Locations = "#6497b1"
Death_Locations = "#b3cde0"
col4 = "#CC0000"
ggmap::register_google(key = "AIzaSyD5w9yNOufvfRxcdGX0TlTZV6nIU63vTEk")
m <- get_map(getbb("Colorado"),source="stamen",maptype = "toner-background")
ggmap(m) +
geom_point(data=deaths, aes(x=lon, y=lat, color = "Death_Locations"))
ggmap(m) +
geom_point(data=deaths, aes(x=lon, y=lat, color = "Death_Locations"))
ggmap(m) +
stat_density2d(data=deaths, aes(x=lon, y=lat, color = "Death_Locations"))
ggmap(m) +
stat_density2d(data=deaths, aes(x=lon, y=lat, color = "Death_Locations"))+
geom_point(data=DATAproviders, aes(x=lon, y=lat, color = "DATA_Provider_Locations"))+
geom_point(data=OTPs, aes(x = lon, y= lat, color= "OTP_Locations"))
